---
title: 面试之高并发盘点.md
date: 2022-04-26 20:23:30
tags:
---
最近面试被问到**谈谈你对高并发的理解**，回答的有点凌乱，特此来重新盘点下以往项目遇到的状况。

### 何为高并发
高并发从我个人理解就是流量比较高，或短时间内的大流量冲击，例如秒杀抢购场景。 
  
公司长期面临高并发的业务场景的话，说明公司本身的规模也比较大，这块业务面向许多人，应该要把流量都吃下来，那么通过合适的机器和方案设计来解决该问题。  
  
如果是短期内某种业务场景的话，那么要考虑把这部分流量合理的消化掉，我这里说的消化有两个意思，一是通过削峰手段慢慢消费掉流量，一个是友好的阻挡流量。

### 高可用
在承受大量冲击的时候我们也希望保证系统业务基本正常，这需要我们设计出一套高可用的架构。针对海量请求，我们可以做限流或者排队策略，针对故障服务，我们可以做熔断和降级策略。

##### 限流
我们先从限流说起，限流可以在数据请求的任意一处链路做起，比如客户端直接限流，常见：按钮置灰，按照某种概率随机丢弃请求，也就是不真正发起请求给服务端；也可以在接入服务器请求，例如网关、nginx，避免流量在后端服务进一步放大；某个微服务本身也可以做到限流。  
###### 滑动时间窗算法
经典算法不说了

###### 漏桶
<img src="https://raw.githubusercontent.com/gezhiwei8899/pic/main/loutongsuanfa.png" width="50%" height="50%">
漏桶算法的本质就是控制总量，非常适用于正点秒杀等场景  

优点：
- 容易实现

缺点：
- 桶大小难以动态调整
- 无法精准控制流出速度

###### 漏桶变种 - 写缓冲  
<img src="https://raw.githubusercontent.com/gezhiwei8899/pic/main/loutongsuanfa.png" width="50%" height="50%">
缓冲所有流量，适用于评论等

###### 令牌桶
<img src="https://raw.githubusercontent.com/gezhiwei8899/pic/main/lingpaitong.png" width="50%" height="50%">
令牌端按照自定义的速率将令牌放入桶中，业务单元需要从桶中获取令牌，获取不到则放弃后续请求。
优点：
- 可以动态调整处理速度

缺点：
- 突发流量可能丢弃很多请求
适用于访问第三方服，防止把下游压垮。  


### 读、写场景下的高并发
##### 读场景
其实这个场景大家第一时间想到的就是加缓存。从客户端自身的缓存开始，包括不限于CDN，应用内缓存（本地缓存），redis缓存。

##### 写场景
这个依赖于业务场景，不同的业务场景下方案不同，总的来说有MQ削峰，分库分表

### 总结
